
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../recipe_4_migrating/">
      
      
        <link rel="next" href="../recipe_6_evaluations/">
      
      
      <link rel="icon" href="../media/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.13">
    
    
      
        <title>Generate an Sales by Region Pie Chart - Azure AI Bites</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#generate-a-sales-by-region-pie-chart-using-code-interpreter-in-azure-ai-foundry" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Azure AI Bites" class="md-header__button md-logo" aria-label="Azure AI Bites" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azure AI Bites
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Generate an Sales by Region Pie Chart
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 2c-1.82 0-3.53.5-5 1.35C8 5.08 10 8.3 10 12s-2 6.92-5 8.65C6.47 21.5 8.18 22 10 22a10 10 0 0 0 10-10A10 10 0 0 0 10 2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Azure AI Bites" class="md-nav__button md-logo" aria-label="Azure AI Bites" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Azure AI Bites
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_1_azure_ai_foundary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started with Azure AI Foundry
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_2_getting_started_ai_foundry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setting up model deployment in Azure AI Foundry
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_3_basic_chat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Chat Completion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_4_migrating/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrate to Azure Inference Chat Completion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Generate an Sales by Region Pie Chart
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Generate an Sales by Region Pie Chart
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      1. Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-developer-environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      2. Developer environment setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-prepare-the-sales-data-file" class="md-nav__link">
    <span class="md-ellipsis">
      3. Prepare the sales data file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-code-sample" class="md-nav__link">
    <span class="md-ellipsis">
      4. Code Sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-complete-code-example" class="md-nav__link">
    <span class="md-ellipsis">
      5. Complete code example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-how-to-run-the-example-code" class="md-nav__link">
    <span class="md-ellipsis">
      6. How to run the example code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_6_evaluations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluate your Agent
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_7_safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementing safety systems with Azure AI Content Safety
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      1. Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-developer-environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      2. Developer environment setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-prepare-the-sales-data-file" class="md-nav__link">
    <span class="md-ellipsis">
      3. Prepare the sales data file
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-code-sample" class="md-nav__link">
    <span class="md-ellipsis">
      4. Code Sample
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-complete-code-example" class="md-nav__link">
    <span class="md-ellipsis">
      5. Complete code example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-how-to-run-the-example-code" class="md-nav__link">
    <span class="md-ellipsis">
      6. How to run the example code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="generate-a-sales-by-region-pie-chart-using-code-interpreter-in-azure-ai-foundry">Generate a Sales by Region Pie Chart Using Code Interpreter in Azure AI Foundry<a class="headerlink" href="#generate-a-sales-by-region-pie-chart-using-code-interpreter-in-azure-ai-foundry" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This article demonstrates how to use the Code Interpreter tool in Azure AI Foundry Agents to generate a pie chart of sales by region from a CSV file. You will use a project connection string and Microsoft Entra ID authentication to securely access the Azure AI Foundry project and run the code interpreter tool.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Python 3.8 or later</li>
<li>Access to Azure AI Foundry services</li>
</ul>
<h2 id="1-authentication">1. Authentication<a class="headerlink" href="#1-authentication" title="Permanent link">&para;</a></h2>
<p>This example uses a project connection string and Microsoft Entra ID authentication.</p>
<p>The <strong>project connection string</strong> is a unique string that allows your application to connect to your Azure AI Foundry project. You can find it in the <strong>Overview</strong> tab of your Azure AI Foundry project in the Azure portal, under <strong>Project details</strong>.</p>
<p><strong>Microsoft Entra ID authentication</strong> uses your Azure identity to securely access Azure resources. You can authenticate using your Azure account credentials. To use this method, ensure you have the necessary permissions and have signed in using the Azure CLI (<code>az login</code>).</p>
<p><strong>Steps:</strong></p>
<ol>
<li>Go to the Azure portal and navigate to your Azure AI Foundry project.</li>
<li>Copy the <strong>Project Connection String</strong> from the <strong>Overview</strong> tab.</li>
<li>Ensure you have the Azure CLI installed and run <code>az login</code> to authenticate with Microsoft Entra ID.</li>
</ol>
<h2 id="2-developer-environment-setup">2. Developer environment setup<a class="headerlink" href="#2-developer-environment-setup" title="Permanent link">&para;</a></h2>
<p>Select your preferred operating system:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Windows (PowerShell)</label><label for="__tabbed_1_2">Linux/macOS</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>Open a terminal (PowerShell).</li>
<li>Create a project folder:
    <div class="highlight"><pre><span></span><code><span class="n">mkdir</span> <span class="n">sales-pie-chart</span>
<span class="nb">cd </span><span class="n">sales-pie-chart</span>
</code></pre></div></li>
<li>Set up a virtual environment:
    <div class="highlight"><pre><span></span><code><span class="n">python</span> <span class="n">-m</span> <span class="n">venv</span> <span class="p">.</span><span class="n">venv</span>
</code></pre></div></li>
<li>Activate the virtual environment:
    <div class="highlight"><pre><span></span><code><span class="p">.\.</span><span class="n">venv</span><span class="p">\</span><span class="n">Scripts</span><span class="p">\</span><span class="n">Activate</span>
</code></pre></div></li>
<li>Install the required libraries:
    <div class="highlight"><pre><span></span><code><span class="n">pip</span> <span class="n">install</span> <span class="n">azure-ai-projects</span><span class="p">==</span><span class="n">1</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">0b9</span> <span class="n">azure-identity</span><span class="p">==</span><span class="n">1</span><span class="p">.</span><span class="n">21</span><span class="p">.</span><span class="n">0</span>
</code></pre></div></li>
<li>Set up environment variables. Replace the placeholders with the actual values:
    <div class="highlight"><pre><span></span><code><span class="nv">$env:PROJECT_CONNECTION_STRING</span> <span class="p">=</span> <span class="s2">&quot;&lt;your-project-connection-string&gt;&quot;</span>
<span class="nv">$env:MODEL_DEPLOYMENT_NAME</span> <span class="p">=</span> <span class="s2">&quot;&lt;your-model-deployment-name&gt;&quot;</span>
</code></pre></div></li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>Open a terminal.</li>
<li>Create a project folder:
    <div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>sales-pie-chart
<span class="nb">cd</span><span class="w"> </span>sales-pie-chart
</code></pre></div></li>
<li>Set up a virtual environment:
    <div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
</code></pre></div></li>
<li>Activate the virtual environment:
    <div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
</code></pre></div></li>
<li>Install the required libraries:
    <div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>azure-ai-projects<span class="o">==</span><span class="m">1</span>.0.0b9<span class="w"> </span>azure-identity<span class="o">==</span><span class="m">1</span>.21.0
</code></pre></div></li>
<li>Set up environment variables. Replace the placeholders with the actual values:
    <div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">PROJECT_CONNECTION_STRING</span><span class="o">=</span><span class="s2">&quot;&lt;your-project-connection-string&gt;&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">MODEL_DEPLOYMENT_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;your-model-deployment-name&gt;&quot;</span>
</code></pre></div></li>
</ol>
</div>
</div>
</div>
<h2 id="3-prepare-the-sales-data-file">3. Prepare the sales data file<a class="headerlink" href="#3-prepare-the-sales-data-file" title="Permanent link">&para;</a></h2>
<p>Create a file named <code>sales_data.csv</code> in your project folder with the following content:</p>
<div class="highlight"><pre><span></span><code>Region,Sales
Europe,120000
China,150000
</code></pre></div>
<h2 id="4-code-sample">4. Code Sample<a class="headerlink" href="#4-code-sample" title="Permanent link">&para;</a></h2>
<p>This code sample demonstrates how to use the Code Interpreter tool in Azure AI Foundry Agents to generate a pie chart from the sales data.</p>
<h3 id="main-code-components">Main code components<a class="headerlink" href="#main-code-components" title="Permanent link">&para;</a></h3>
<h4 id="import-required-libraries">Import required libraries<a class="headerlink" href="#import-required-libraries" title="Permanent link">&para;</a></h4>
<p>This section imports the necessary Python libraries for authentication and interaction with Azure AI Foundry.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.ai.projects</span><span class="w"> </span><span class="kn">import</span> <span class="n">AIProjectClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.ai.projects.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">CodeInterpreterTool</span><span class="p">,</span> <span class="n">FilePurpose</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</code></pre></div>
<h4 id="upload-the-sales-data-file">Upload the sales data file<a class="headerlink" href="#upload-the-sales-data-file" title="Permanent link">&para;</a></h4>
<p>This code uploads the <code>sales_data.csv</code> file to your Azure AI Foundry project for use with the Code Interpreter.</p>
<div class="highlight"><pre><span></span><code><span class="n">project_client</span> <span class="o">=</span> <span class="n">AIProjectClient</span><span class="o">.</span><span class="n">from_connection_string</span><span class="p">(</span>
    <span class="n">credential</span><span class="o">=</span><span class="n">DefaultAzureCredential</span><span class="p">(),</span>
    <span class="n">conn_str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PROJECT_CONNECTION_STRING&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">project_client</span><span class="p">:</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">upload_file_and_poll</span><span class="p">(</span>
        <span class="n">file_path</span><span class="o">=</span><span class="s2">&quot;sales_data.csv&quot;</span><span class="p">,</span>
        <span class="n">purpose</span><span class="o">=</span><span class="n">FilePurpose</span><span class="o">.</span><span class="n">AGENTS</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploaded file, file ID: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="create-an-agent-with-the-code-interpreter-tool">Create an agent with the Code Interpreter tool<a class="headerlink" href="#create-an-agent-with-the-code-interpreter-tool" title="Permanent link">&para;</a></h4>
<p>This code creates an agent with the Code Interpreter tool, referencing the uploaded file.</p>
<div class="highlight"><pre><span></span><code>    <span class="n">code_interpreter</span> <span class="o">=</span> <span class="n">CodeInterpreterTool</span><span class="p">(</span><span class="n">file_ids</span><span class="o">=</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

    <span class="n">agent</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">create_agent</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MODEL_DEPLOYMENT_NAME&quot;</span><span class="p">],</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sales-pie-chart-agent&quot;</span><span class="p">,</span>
        <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant that generates charts from data.&quot;</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="n">code_interpreter</span><span class="o">.</span><span class="n">definitions</span><span class="p">,</span>
        <span class="n">tool_resources</span><span class="o">=</span><span class="n">code_interpreter</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created agent, agent ID: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="create-a-thread-and-message-to-request-the-pie-chart">Create a thread and message to request the pie chart<a class="headerlink" href="#create-a-thread-and-message-to-request-the-pie-chart" title="Permanent link">&para;</a></h4>
<p>This code creates a thread and sends a message to the agent, instructing it to generate a pie chart.</p>
<div class="highlight"><pre><span></span><code>    <span class="n">thread</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">create_thread</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created thread, thread ID: </span><span class="si">{</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">create_message</span><span class="p">(</span>
        <span class="n">thread_id</span><span class="o">=</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
        <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Generate a pie chart of sales by region using the sales_data.csv file.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created message, message ID: </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h4 id="run-the-agent-and-save-the-generated-chart">Run the agent and save the generated chart<a class="headerlink" href="#run-the-agent-and-save-the-generated-chart" title="Permanent link">&para;</a></h4>
<p>This code runs the agent, retrieves the generated chart, and saves it locally.</p>
<div class="highlight"><pre><span></span><code>    <span class="n">run</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">create_and_process_run</span><span class="p">(</span><span class="n">thread_id</span><span class="o">=</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run finished with status: </span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">messages</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">list_messages</span><span class="p">(</span><span class="n">thread_id</span><span class="o">=</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">image_content</span> <span class="ow">in</span> <span class="n">messages</span><span class="o">.</span><span class="n">image_contents</span><span class="p">:</span>
        <span class="n">file_id</span> <span class="o">=</span> <span class="n">image_content</span><span class="o">.</span><span class="n">image_file</span><span class="o">.</span><span class="n">file_id</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">_sales_pie_chart.png&quot;</span>
        <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">save_file</span><span class="p">(</span><span class="n">file_id</span><span class="o">=</span><span class="n">file_id</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved pie chart image to: </span><span class="si">{</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">delete_agent</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleted agent&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="5-complete-code-example">5. Complete code example<a class="headerlink" href="#5-complete-code-example" title="Permanent link">&para;</a></h2>
<p>The following is the complete code example. Save this as <code>example.py</code> in your project folder.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Generate a sales by region pie chart using the Code Interpreter tool in Azure AI Foundry Agents.</span>
<span class="sd">This script uploads a CSV file, creates an agent with the Code Interpreter, and generates a pie chart.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.ai.projects</span><span class="w"> </span><span class="kn">import</span> <span class="n">AIProjectClient</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.ai.projects.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">CodeInterpreterTool</span><span class="p">,</span> <span class="n">FilePurpose</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function to upload sales data, create an agent with the Code Interpreter tool,</span>
<span class="sd">    and generate a pie chart of sales by region.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">project_client</span> <span class="o">=</span> <span class="n">AIProjectClient</span><span class="o">.</span><span class="n">from_connection_string</span><span class="p">(</span>
        <span class="n">credential</span><span class="o">=</span><span class="n">DefaultAzureCredential</span><span class="p">(),</span>
        <span class="n">conn_str</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PROJECT_CONNECTION_STRING&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="k">with</span> <span class="n">project_client</span><span class="p">:</span>
        <span class="c1"># Upload the sales data file</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">upload_file_and_poll</span><span class="p">(</span>
            <span class="n">file_path</span><span class="o">=</span><span class="s2">&quot;sales_data.csv&quot;</span><span class="p">,</span>
            <span class="n">purpose</span><span class="o">=</span><span class="n">FilePurpose</span><span class="o">.</span><span class="n">AGENTS</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uploaded file, file ID: </span><span class="si">{</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create the Code Interpreter tool</span>
        <span class="n">code_interpreter</span> <span class="o">=</span> <span class="n">CodeInterpreterTool</span><span class="p">(</span><span class="n">file_ids</span><span class="o">=</span><span class="p">[</span><span class="n">file</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

        <span class="c1"># Create the agent</span>
        <span class="n">agent</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">create_agent</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MODEL_DEPLOYMENT_NAME&quot;</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sales-pie-chart-agent&quot;</span><span class="p">,</span>
            <span class="n">instructions</span><span class="o">=</span><span class="s2">&quot;You are a helpful assistant that generates charts from data.&quot;</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">code_interpreter</span><span class="o">.</span><span class="n">definitions</span><span class="p">,</span>
            <span class="n">tool_resources</span><span class="o">=</span><span class="n">code_interpreter</span><span class="o">.</span><span class="n">resources</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created agent, agent ID: </span><span class="si">{</span><span class="n">agent</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Create a thread and message</span>
        <span class="n">thread</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">create_thread</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created thread, thread ID: </span><span class="si">{</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">create_message</span><span class="p">(</span>
            <span class="n">thread_id</span><span class="o">=</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">role</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
            <span class="n">content</span><span class="o">=</span><span class="s2">&quot;Generate a pie chart of sales by region using the sales_data.csv file.&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created message, message ID: </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Run the agent</span>
        <span class="n">run</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">create_and_process_run</span><span class="p">(</span><span class="n">thread_id</span><span class="o">=</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">agent_id</span><span class="o">=</span><span class="n">agent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Run finished with status: </span><span class="si">{</span><span class="n">run</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Retrieve and save the generated chart</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">list_messages</span><span class="p">(</span><span class="n">thread_id</span><span class="o">=</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">image_content</span> <span class="ow">in</span> <span class="n">messages</span><span class="o">.</span><span class="n">image_contents</span><span class="p">:</span>
            <span class="n">file_id</span> <span class="o">=</span> <span class="n">image_content</span><span class="o">.</span><span class="n">image_file</span><span class="o">.</span><span class="n">file_id</span>
            <span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_id</span><span class="si">}</span><span class="s2">_sales_pie_chart.png&quot;</span>
            <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">save_file</span><span class="p">(</span><span class="n">file_id</span><span class="o">=</span><span class="n">file_id</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="n">file_name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saved pie chart image to: </span><span class="si">{</span><span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Clean up</span>
        <span class="n">project_client</span><span class="o">.</span><span class="n">agents</span><span class="o">.</span><span class="n">delete_agent</span><span class="p">(</span><span class="n">agent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deleted agent&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<h2 id="6-how-to-run-the-example-code">6. How to run the example code<a class="headerlink" href="#6-how-to-run-the-example-code" title="Permanent link">&para;</a></h2>
<ol>
<li>Ensure you have created the <code>sales_data.csv</code> file in your project folder.</li>
<li>Set the required environment variables as described in the developer environment setup.</li>
<li>
<p>Run the script:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>example.py
</code></pre></div>
</li>
<li>
<p>After the script completes, the generated pie chart image will be saved in your project folder.</p>
</li>
</ol>
<h2 id="next-steps">Next steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li>Learn more about <a href="https://learn.microsoft.com/azure/ai-studio/concepts/agents-overview" target="_blank">Azure AI Foundry Agents</a></li>
<li>Explore <a href="https://learn.microsoft.com/azure/ai-studio/concepts/agents-code-interpreter" target="_blank">Code Interpreter tool documentation</a></li>
<li>Review <a href="https://learn.microsoft.com/azure/ai-studio/concepts/authentication" target="_blank">Azure AI Foundry authentication options</a></li>
<li>See more <a href="https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/ai/azure-ai-projects/samples" target="_blank">Azure AI Foundry code samples</a></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../recipe_4_migrating/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Migrate to Azure Inference Chat Completion">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Migrate to Azure Inference Chat Completion
              </div>
            </div>
          </a>
        
        
          
          <a href="../recipe_6_evaluations/" class="md-footer__link md-footer__link--next" aria-label="Next: Evaluate your Agent">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Evaluate your Agent
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.footer", "content.code.copy", "navigation.tabs.sticky", "content.tabs.link"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>