
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../recipe_6_evaluations/">
      
      
      
      <link rel="icon" href="../media/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.13">
    
    
      
        <title>Implementing safety systems with Azure AI Content Safety - Azure AI Bites</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#add-safety-elements-after-evaluation-with-azure-ai-evaluation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Azure AI Bites" class="md-header__button md-logo" aria-label="Azure AI Bites" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Azure AI Bites
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Implementing safety systems with Azure AI Content Safety
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 2c-1.82 0-3.53.5-5 1.35C8 5.08 10 8.3 10 12s-2 6.92-5 8.65C6.47 21.5 8.18 22 10 22a10 10 0 0 0 10-10A10 10 0 0 0 10 2"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Azure AI Bites" class="md-nav__button md-logo" aria-label="Azure AI Bites" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Azure AI Bites
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_1_azure_ai_foundary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting started with Azure AI Foundry
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_2_getting_started_ai_foundry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setting up model deployment in Azure AI Foundry
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_3_basic_chat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Chat Completion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_4_migrating/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Migrate to Azure Inference Chat Completion
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_5_generate_image/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generate an Sales by Region Pie Chart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../recipe_6_evaluations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Evaluate your Agent
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Implementing safety systems with Azure AI Content Safety
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Implementing safety systems with Azure AI Content Safety
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      1. Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-developer-environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      2. Developer environment setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-main-code-components" class="md-nav__link">
    <span class="md-ellipsis">
      3. Main code components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-complete-code" class="md-nav__link">
    <span class="md-ellipsis">
      4. Complete code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-how-to-run-the-example-code" class="md-nav__link">
    <span class="md-ellipsis">
      5. How to run the example code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      6. Next steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      1. Authentication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-developer-environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      2. Developer environment setup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-main-code-components" class="md-nav__link">
    <span class="md-ellipsis">
      3. Main code components
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-complete-code" class="md-nav__link">
    <span class="md-ellipsis">
      4. Complete code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-how-to-run-the-example-code" class="md-nav__link">
    <span class="md-ellipsis">
      5. How to run the example code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      6. Next steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="add-safety-elements-after-evaluation-with-azure-ai-evaluation">Add Safety Elements After Evaluation with Azure AI Evaluation<a class="headerlink" href="#add-safety-elements-after-evaluation-with-azure-ai-evaluation" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>This article demonstrates how to add safety elements after evaluating AI model outputs using the Azure AI Evaluation library. You will learn how to apply prompt shields, groundedness checks, custom safety categories, and text moderation to your evaluation workflow. The goal is to help you ensure that your AI model outputs are safe, relevant, and aligned with your requirements.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Python 3.8 or later</li>
<li>Access to Azure AI Foundry services</li>
</ul>
<h2 id="1-authentication">1. Authentication<a class="headerlink" href="#1-authentication" title="Permanent link">&para;</a></h2>
<p>Azure AI Evaluation supports authentication using a project connection string and Microsoft Entra ID.</p>
<ul>
<li><strong>Project Connection String</strong>: This string connects your code to a specific Azure AI Foundry project. You can find it in the Azure AI Foundry portal by selecting your project and copying the value from the <strong>Overview</strong> tab under <strong>Project details</strong>.</li>
<li><strong>Microsoft Entra ID Authentication</strong>: This method uses your Azure identity to securely access Azure resources. You typically authenticate by running <code>az login</code> with the Azure CLI, which allows your code to use your credentials.</li>
</ul>
<p>To use these methods:</p>
<ol>
<li>Go to the Azure AI Foundry portal.</li>
<li>Select your project.</li>
<li>Copy the <strong>Project Connection String</strong> from the <strong>Overview</strong> tab.</li>
<li>Ensure you have the Azure CLI installed and run <code>az login</code> to authenticate with Microsoft Entra ID.</li>
</ol>
<h2 id="2-developer-environment-setup">2. Developer environment setup<a class="headerlink" href="#2-developer-environment-setup" title="Permanent link">&para;</a></h2>
<p>Select your preferred operating system:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Windows (PowerShell)</label><label for="__tabbed_1_2">Linux/macOS</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ol>
<li>Open a terminal (PowerShell).</li>
<li>Create a project folder:
    <div class="highlight"><pre><span></span><code><span class="n">mkdir</span> <span class="n">ai-evaluation-safety</span>
<span class="nb">cd </span><span class="n">ai-evaluation-safety</span>
</code></pre></div></li>
<li>Set up a virtual environment:
    <div class="highlight"><pre><span></span><code><span class="n">python</span> <span class="n">-m</span> <span class="n">venv</span> <span class="p">.</span><span class="n">venv</span>
</code></pre></div></li>
<li>Activate the virtual environment:
    <div class="highlight"><pre><span></span><code><span class="p">.\.</span><span class="n">venv</span><span class="p">\</span><span class="n">Scripts</span><span class="p">\</span><span class="n">Activate</span>
</code></pre></div></li>
<li>Install the required libraries:
    <div class="highlight"><pre><span></span><code><span class="n">pip</span> <span class="n">install</span> <span class="n">azure-ai-evaluation</span><span class="p">==</span><span class="n">1</span><span class="p">.</span><span class="n">5</span><span class="p">.</span><span class="n">0</span> <span class="n">azure-identity</span><span class="p">==</span><span class="n">1</span><span class="p">.</span><span class="n">21</span><span class="p">.</span><span class="n">0</span>
</code></pre></div></li>
<li>Set up environment variables (replace the placeholders with the actual values):
    <div class="highlight"><pre><span></span><code><span class="nv">$env:PROJECT_CONNECTION_STRING</span><span class="p">=</span><span class="s2">&quot;&lt;your-project-connection-string&gt;&quot;</span>
<span class="nv">$env:AZURE_SUBSCRIPTION_ID</span><span class="p">=</span><span class="s2">&quot;&lt;your-subscription-id&gt;&quot;</span>
<span class="nv">$env:AZURE_RESOURCE_GROUP_NAME</span><span class="p">=</span><span class="s2">&quot;&lt;your-resource-group&gt;&quot;</span>
<span class="nv">$env:AZURE_PROJECT_NAME</span><span class="p">=</span><span class="s2">&quot;&lt;your-project-name&gt;&quot;</span>
</code></pre></div></li>
</ol>
</div>
<div class="tabbed-block">
<ol>
<li>Open a terminal.</li>
<li>Create a project folder:
    <div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>ai-evaluation-safety
<span class="nb">cd</span><span class="w"> </span>ai-evaluation-safety
</code></pre></div></li>
<li>Set up a virtual environment:
    <div class="highlight"><pre><span></span><code>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>.venv
</code></pre></div></li>
<li>Activate the virtual environment:
    <div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
</code></pre></div></li>
<li>Install the required libraries:
    <div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>azure-ai-evaluation<span class="o">==</span><span class="m">1</span>.5.0<span class="w"> </span>azure-identity<span class="o">==</span><span class="m">1</span>.21.0
</code></pre></div></li>
<li>Set up environment variables (replace the placeholders with the actual values):
    <div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">PROJECT_CONNECTION_STRING</span><span class="o">=</span><span class="s2">&quot;&lt;your-project-connection-string&gt;&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_SUBSCRIPTION_ID</span><span class="o">=</span><span class="s2">&quot;&lt;your-subscription-id&gt;&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_RESOURCE_GROUP_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;your-resource-group&gt;&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">AZURE_PROJECT_NAME</span><span class="o">=</span><span class="s2">&quot;&lt;your-project-name&gt;&quot;</span>
</code></pre></div></li>
</ol>
</div>
</div>
</div>
<p>Replace the placeholders with the actual values from your Azure AI Foundry project.</p>
<h2 id="3-main-code-components">3. Main code components<a class="headerlink" href="#3-main-code-components" title="Permanent link">&para;</a></h2>
<p>This section explains how to add safety elements after evaluation using the Azure AI Evaluation library.</p>
<h3 id="31-imports-and-authentication">3.1. Imports and Authentication<a class="headerlink" href="#31-imports-and-authentication" title="Permanent link">&para;</a></h3>
<p>You will use the Azure AI Evaluation and Azure Identity libraries to authenticate and access your project.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">azure.ai.evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ContentSafetyEvaluator</span><span class="p">,</span>
    <span class="n">GroundednessEvaluator</span><span class="p">,</span>
    <span class="n">CustomCategoryEvaluator</span><span class="p">,</span>
    <span class="n">TextModerationEvaluator</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>
</code></pre></div>
<h3 id="32-set-up-project-and-credentials">3.2. Set Up Project and Credentials<a class="headerlink" href="#32-set-up-project-and-credentials" title="Permanent link">&para;</a></h3>
<p>Set up your Azure AI project and credentials using environment variables.</p>
<div class="highlight"><pre><span></span><code><span class="n">azure_ai_project</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_SUBSCRIPTION_ID&quot;</span><span class="p">],</span>
    <span class="s2">&quot;resource_group_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_RESOURCE_GROUP_NAME&quot;</span><span class="p">],</span>
    <span class="s2">&quot;project_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_PROJECT_NAME&quot;</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">credential</span> <span class="o">=</span> <span class="n">DefaultAzureCredential</span><span class="p">()</span>
</code></pre></div>
<h3 id="33-prompt-shields">3.3. Prompt Shields<a class="headerlink" href="#33-prompt-shields" title="Permanent link">&para;</a></h3>
<p>Prompt shields help detect and block potentially harmful or unsafe prompts before they reach your model.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example: Use ContentSafetyEvaluator as a prompt shield</span>
<span class="n">prompt_shield</span> <span class="o">=</span> <span class="n">ContentSafetyEvaluator</span><span class="p">(</span>
    <span class="n">azure_ai_project</span><span class="o">=</span><span class="n">azure_ai_project</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="n">credential</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">prompt_shield</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="s2">&quot;Write a story about violence.&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="s2">&quot;Once upon a time...&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prompt Shield Result:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div>
<h3 id="34-groundedness">3.4. Groundedness<a class="headerlink" href="#34-groundedness" title="Permanent link">&para;</a></h3>
<p>Groundedness checks ensure that the model's response is based on provided context or source data.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example: Use GroundednessEvaluator to check if the response is grounded in the context</span>
<span class="n">groundedness_evaluator</span> <span class="o">=</span> <span class="n">GroundednessEvaluator</span><span class="p">(</span>
    <span class="n">model_config</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;azure_endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;your-endpoint&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;your-key&gt;&quot;</span><span class="p">,</span> <span class="s2">&quot;azure_deployment&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;your-deployment&gt;&quot;</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">groundedness_result</span> <span class="o">=</span> <span class="n">groundedness_evaluator</span><span class="p">(</span>
    <span class="n">response</span><span class="o">=</span><span class="s2">&quot;Paris is the capital of France.&quot;</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="s2">&quot;France, a country in Western Europe, has Paris as its capital.&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Groundedness Result:&quot;</span><span class="p">,</span> <span class="n">groundedness_result</span><span class="p">)</span>
</code></pre></div>
<h3 id="35-custom-categories">3.5. Custom Categories<a class="headerlink" href="#35-custom-categories" title="Permanent link">&para;</a></h3>
<p>You can define custom categories to flag or filter content based on your organization's needs.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example: Use CustomCategoryEvaluator for a custom category</span>
<span class="n">custom_category_evaluator</span> <span class="o">=</span> <span class="n">CustomCategoryEvaluator</span><span class="p">(</span>
    <span class="n">azure_ai_project</span><span class="o">=</span><span class="n">azure_ai_project</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="n">credential</span><span class="p">,</span>
    <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;politics&quot;</span><span class="p">,</span> <span class="s2">&quot;medical&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">custom_category_result</span> <span class="o">=</span> <span class="n">custom_category_evaluator</span><span class="p">(</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;Tell me about the latest political news.&quot;</span><span class="p">,</span>
    <span class="n">response</span><span class="o">=</span><span class="s2">&quot;The election results were announced today.&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom Category Result:&quot;</span><span class="p">,</span> <span class="n">custom_category_result</span><span class="p">)</span>
</code></pre></div>
<h3 id="36-text-moderation">3.6. Text Moderation<a class="headerlink" href="#36-text-moderation" title="Permanent link">&para;</a></h3>
<p>Text moderation helps detect and filter out inappropriate or unsafe content in model outputs.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example: Use TextModerationEvaluator to moderate text</span>
<span class="n">text_moderation_evaluator</span> <span class="o">=</span> <span class="n">TextModerationEvaluator</span><span class="p">(</span>
    <span class="n">azure_ai_project</span><span class="o">=</span><span class="n">azure_ai_project</span><span class="p">,</span>
    <span class="n">credential</span><span class="o">=</span><span class="n">credential</span>
<span class="p">)</span>
<span class="n">moderation_result</span> <span class="o">=</span> <span class="n">text_moderation_evaluator</span><span class="p">(</span>
    <span class="n">query</span><span class="o">=</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">,</span>
    <span class="n">response</span><span class="o">=</span><span class="s2">&quot;Paris is the capital of France.&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text Moderation Result:&quot;</span><span class="p">,</span> <span class="n">moderation_result</span><span class="p">)</span>
</code></pre></div>
<h2 id="4-complete-code">4. Complete code<a class="headerlink" href="#4-complete-code" title="Permanent link">&para;</a></h2>
<p>The following example demonstrates how to add all safety elements after evaluation. Save this code as <code>add_safety_elements.py</code>.</p>
<div class="highlight"><pre><span></span><code><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Demonstrates how to add safety elements after evaluation using Azure AI Evaluation.</span>
<span class="sd">Includes prompt shields, groundedness, custom categories, and text moderation.</span>

<span class="sd">Set the following environment variables before running:</span>
<span class="sd">- PROJECT_CONNECTION_STRING</span>
<span class="sd">- AZURE_SUBSCRIPTION_ID</span>
<span class="sd">- AZURE_RESOURCE_GROUP_NAME</span>
<span class="sd">- AZURE_PROJECT_NAME</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">azure.ai.evaluation</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ContentSafetyEvaluator</span><span class="p">,</span>
    <span class="n">GroundednessEvaluator</span><span class="p">,</span>
    <span class="n">CustomCategoryEvaluator</span><span class="p">,</span>
    <span class="n">TextModerationEvaluator</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">azure.identity</span><span class="w"> </span><span class="kn">import</span> <span class="n">DefaultAzureCredential</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run safety evaluations on AI model outputs using various evaluators.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">azure_ai_project</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;subscription_id&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_SUBSCRIPTION_ID&quot;</span><span class="p">],</span>
        <span class="s2">&quot;resource_group_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_RESOURCE_GROUP_NAME&quot;</span><span class="p">],</span>
        <span class="s2">&quot;project_name&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;AZURE_PROJECT_NAME&quot;</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">credential</span> <span class="o">=</span> <span class="n">DefaultAzureCredential</span><span class="p">()</span>

    <span class="c1"># Prompt Shield</span>
    <span class="n">prompt_shield</span> <span class="o">=</span> <span class="n">ContentSafetyEvaluator</span><span class="p">(</span>
        <span class="n">azure_ai_project</span><span class="o">=</span><span class="n">azure_ai_project</span><span class="p">,</span>
        <span class="n">credential</span><span class="o">=</span><span class="n">credential</span>
    <span class="p">)</span>
    <span class="n">prompt_shield_result</span> <span class="o">=</span> <span class="n">prompt_shield</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;Write a story about violence.&quot;</span><span class="p">,</span>
        <span class="n">response</span><span class="o">=</span><span class="s2">&quot;Once upon a time...&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prompt Shield Result:&quot;</span><span class="p">,</span> <span class="n">prompt_shield_result</span><span class="p">)</span>

    <span class="c1"># Groundedness</span>
    <span class="n">groundedness_evaluator</span> <span class="o">=</span> <span class="n">GroundednessEvaluator</span><span class="p">(</span>
        <span class="n">model_config</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;azure_endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;your-endpoint&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;your-key&gt;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;azure_deployment&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;your-deployment&gt;&quot;</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">groundedness_result</span> <span class="o">=</span> <span class="n">groundedness_evaluator</span><span class="p">(</span>
        <span class="n">response</span><span class="o">=</span><span class="s2">&quot;Paris is the capital of France.&quot;</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="s2">&quot;France, a country in Western Europe, has Paris as its capital.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Groundedness Result:&quot;</span><span class="p">,</span> <span class="n">groundedness_result</span><span class="p">)</span>

    <span class="c1"># Custom Categories</span>
    <span class="n">custom_category_evaluator</span> <span class="o">=</span> <span class="n">CustomCategoryEvaluator</span><span class="p">(</span>
        <span class="n">azure_ai_project</span><span class="o">=</span><span class="n">azure_ai_project</span><span class="p">,</span>
        <span class="n">credential</span><span class="o">=</span><span class="n">credential</span><span class="p">,</span>
        <span class="n">categories</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;politics&quot;</span><span class="p">,</span> <span class="s2">&quot;medical&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">custom_category_result</span> <span class="o">=</span> <span class="n">custom_category_evaluator</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;Tell me about the latest political news.&quot;</span><span class="p">,</span>
        <span class="n">response</span><span class="o">=</span><span class="s2">&quot;The election results were announced today.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Custom Category Result:&quot;</span><span class="p">,</span> <span class="n">custom_category_result</span><span class="p">)</span>

    <span class="c1"># Text Moderation</span>
    <span class="n">text_moderation_evaluator</span> <span class="o">=</span> <span class="n">TextModerationEvaluator</span><span class="p">(</span>
        <span class="n">azure_ai_project</span><span class="o">=</span><span class="n">azure_ai_project</span><span class="p">,</span>
        <span class="n">credential</span><span class="o">=</span><span class="n">credential</span>
    <span class="p">)</span>
    <span class="n">moderation_result</span> <span class="o">=</span> <span class="n">text_moderation_evaluator</span><span class="p">(</span>
        <span class="n">query</span><span class="o">=</span><span class="s2">&quot;What is the capital of France?&quot;</span><span class="p">,</span>
        <span class="n">response</span><span class="o">=</span><span class="s2">&quot;Paris is the capital of France.&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Text Moderation Result:&quot;</span><span class="p">,</span> <span class="n">moderation_result</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<h2 id="5-how-to-run-the-example-code">5. How to run the example code<a class="headerlink" href="#5-how-to-run-the-example-code" title="Permanent link">&para;</a></h2>
<ol>
<li>Ensure your environment variables are set as described in the developer environment setup.</li>
<li>Save the complete code as <code>add_safety_elements.py</code>.</li>
<li>
<p>Run the script:</p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>add_safety_elements.py
</code></pre></div>
</li>
</ol>
<h2 id="6-next-steps">6. Next steps<a class="headerlink" href="#6-next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://aka.ms/azure-ai-evaluation-docs" target="_blank">Azure AI Evaluation documentation</a></li>
<li><a href="https://learn.microsoft.com/azure/ai-studio/" target="_blank">Azure AI Foundry documentation</a></li>
<li><a href="https://learn.microsoft.com/azure/ai-services/content-safety/overview" target="_blank">Content Safety in Azure AI</a></li>
<li><a href="https://learn.microsoft.com/azure/developer/python/sdk/identity/" target="_blank">Azure Identity authentication</a></li>
<li><a href="https://github.com/Azure/azure-sdk-for-python/tree/main/sdk/evaluation/azure-ai-evaluation/samples" target="_blank">Azure AI Evaluation samples</a></li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../recipe_6_evaluations/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Evaluate your Agent">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Evaluate your Agent
              </div>
            </div>
          </a>
        
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.footer", "content.code.copy", "navigation.tabs.sticky", "content.tabs.link"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>